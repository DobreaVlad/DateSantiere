@model List<Santier>

@{
    ViewData["Title"] = "Gestionare Șantiere";
    var search = ViewBag.Search as string;
    var judet = ViewBag.Judet as string;
    var categorie = ViewBag.Categorie as string;
    var status = ViewBag.Status as string;
    var isActive = ViewBag.IsActive as bool?;
    var judete = ViewBag.Judete as List<string> ?? new List<string>();
    var categorii = ViewBag.Categorii as List<string> ?? new List<string>();
    var statuses = ViewBag.Statuses as List<string> ?? new List<string>();
    var currentPage = ViewBag.CurrentPage as int? ?? 1;
    var totalPages = ViewBag.TotalPages as int? ?? 1;
    var totalCount = ViewBag.TotalCount as int? ?? 0;
}

<div style="padding: 40px 0; background: #e5e7eb; min-height: calc(100vh - 200px);">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 style="color: #374151; margin: 0;">Gestionare Șantiere</h1>
            <div style="display: flex; gap: 10px;">
                <a asp-action="ExportSantiere" 
                   asp-route-search="@search"
                   asp-route-judet="@judet"
                   asp-route-categorie="@categorie"
                   asp-route-status="@status"
                   asp-route-isActive="@isActive"
                   class="btn" style="background: #8b5cf6; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none;">
                    <i class="bi bi-file-earmark-excel"></i> Export Excel
                </a>
                <a asp-action="CreateSantiere" class="btn" style="background: #10b981; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none;">
                    <i class="bi bi-plus-circle"></i> Adaugă Șantier
                </a>
                <a asp-controller="Admin" asp-action="Index" class="btn" style="background: #6b7280; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none;">
                    <i class="bi bi-arrow-left"></i> Înapoi la Admin
                </a>
            </div>
        </div>

        @if (TempData["Success"] != null)
        {
            <div style="padding: 15px; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 8px; margin-bottom: 20px;">
                <p style="margin: 0; color: #065f46;">@TempData["Success"]</p>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div style="padding: 15px; background: #fee2e2; border-left: 4px solid #ef4444; border-radius: 8px; margin-bottom: 20px;">
                <p style="margin: 0; color: #991b1b;">@TempData["Error"]</p>
            </div>
        }

        <!-- Search and Filter Section -->
        <div style="background: white; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <form method="get" asp-action="Santiere" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: end;">
                <div>
                    <label style="display: block; color: #374151; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
                        <i class="bi bi-search"></i> Căutare
                    </label>
                    <input type="text" name="search" value="@search" placeholder="Nume, beneficiar, adresă..." 
                           style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                </div>

                <div>
                    <label style="display: block; color: #374151; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
                        <i class="bi bi-geo"></i> Județ
                    </label>
                    <select name="judet" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                        <option value="">Toate</option>
                        @foreach (var j in judete)
                        {
                            <option value="@j" selected="@(judet == j)">@j</option>
                        }
                    </select>
                </div>

                <div>
                    <label style="display: block; color: #374151; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
                        <i class="bi bi-tag"></i> Categorie
                    </label>
                    <select name="categorie" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                        <option value="">Toate</option>
                        @foreach (var cat in categorii)
                        {
                            <option value="@cat" selected="@(categorie == cat)">@cat</option>
                        }
                    </select>
                </div>

                <div>
                    <label style="display: block; color: #374151; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
                        <i class="bi bi-check-circle"></i> Status
                    </label>
                    <select name="status" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                        <option value="">Toate</option>
                        @foreach (var st in statuses)
                        {
                            <option value="@st" selected="@(status == st)">@st</option>
                        }
                    </select>
                </div>

                <div>
                    <label style="display: block; color: #374151; font-weight: 600; margin-bottom: 8px; font-size: 14px;">
                        <i class="bi bi-toggle-on"></i> Stare
                    </label>
                    <select name="isActive" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                        <option value="">Toate</option>
                        <option value="true" selected="@(isActive == true)">Activ</option>
                        <option value="false" selected="@(isActive == false)">Inactiv</option>
                    </select>
                </div>

                <div>
                    <button type="submit" style="width: 100%; padding: 10px 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px;">
                        <i class="bi bi-search"></i> Căutare
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Summary -->
        <div style="background: white; border-radius: 12px; padding: 15px 25px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <p style="margin: 0; color: #6b7280; font-size: 14px;">
                <strong>Total:</strong> @totalCount șantiere
            </p>
        </div>

        <!-- Santiere Table -->
        <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            @if (Model.Count > 0)
            {
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f3f4f6; border-bottom: 2px solid #e5e7eb;">
                            <tr>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">ID</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Nume</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Județ</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Categorie</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Beneficiar</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Status</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Stare</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600; color: #374151; font-size: 14px;">Data Creare</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600; color: #374151; font-size: 14px;">Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var santier in Model)
                            {
                                <tr style="border-bottom: 1px solid #e5e7eb; hover {background: #f9fafb;}">
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">@santier.Id</td>
                                    <td style="padding: 15px; color: #1f2937; font-weight: 500; font-size: 14px;">@santier.Name</td>
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">@santier.Judet</td>
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">@santier.Categorie</td>
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">@santier.Beneficiar</td>
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">
                                        @if (string.IsNullOrEmpty(santier.Status))
                                        {
                                            <span style="display: inline-block; padding: 4px 8px; background: #e5e7eb; color: #6b7280; border-radius: 4px; font-size: 12px;">N/A</span>
                                        }
                                        else
                                        {
                                            <span style="display: inline-block; padding: 4px 8px; background: #dbeafe; color: #1e40af; border-radius: 4px; font-size: 12px;">@santier.Status</span>
                                        }
                                    </td>
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">
                                        @if (santier.IsActive)
                                        {
                                            <span style="display: inline-block; padding: 4px 8px; background: #dcfce7; color: #166534; border-radius: 4px; font-weight: 500; font-size: 12px;">Activ</span>
                                        }
                                        else
                                        {
                                            <span style="display: inline-block; padding: 4px 8px; background: #fee2e2; color: #991b1b; border-radius: 4px; font-weight: 500; font-size: 12px;">Inactiv</span>
                                        }
                                    </td>
                                    <td style="padding: 15px; color: #6b7280; font-size: 14px;">@santier.CreatedAt.ToString("yyyy-MM-dd")</td>
                                    <td style="padding: 15px; text-align: center;">
                                        <div style="display: flex; gap: 8px; justify-content: center;">
                                            <a asp-action="EditSantiere" asp-route-id="@santier.Id" class="btn" 
                                               style="padding: 6px 12px; background: #3b82f6; color: white; border-radius: 6px; text-decoration: none; font-size: 12px; cursor: pointer;">
                                                <i class="bi bi-pencil"></i> Editare
                                            </a>
                                            <form method="post" asp-action="DeleteSantiere" asp-route-id="@santier.Id" style="display: inline;" 
                                                  onsubmit="return confirm('Ești sigur că vrei să ștergi acest șantier?');">
                                                <button type="submit" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; text-decoration: none; font-size: 12px; cursor: pointer;">
                                                    <i class="bi bi-trash"></i> Ștergere
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                @if (totalPages > 1)
                {
                    <div style="display: flex; justify-content: center; gap: 5px; padding: 20px; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                        @for (int i = 1; i <= totalPages; i++)
                        {
                            <a asp-action="Santiere" 
                               asp-route-search="@search"
                               asp-route-judet="@judet"
                               asp-route-categorie="@categorie"
                               asp-route-status="@status"
                               asp-route-isActive="@isActive"
                               asp-route-page="@i"
                               style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; text-decoration: none; color: @(i == currentPage ? "white" : "#374151"); background: @(i == currentPage ? "#3b82f6" : "white"); cursor: pointer;">
                                @i
                            </a>
                        }
                    </div>
                }
            }
            else
            {
                <div style="padding: 40px; text-align: center; color: #6b7280;">
                    <i class="bi bi-inbox" style="font-size: 48px; color: #d1d5db; display: block; margin-bottom: 15px;"></i>
                    <p style="font-size: 16px; margin: 0;">Nu au fost găsite șantiere.</p>
                </div>
            }
        </div>
    </div>
</div>

<style>
    tr:hover {
        background: #f9fafb !important;
    }
    
    .btn:hover {
        opacity: 0.9;
    }
</style>
